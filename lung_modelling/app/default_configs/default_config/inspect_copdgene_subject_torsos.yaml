# Workflow to refine subject selection by inspecting torso meshes for holes
# Selected dirs can be regenerated by copying from formatted output of select_copdgene_subjects.yaml
dataset_root: null
log_level: "INFO"
use_multiprocessing: False

tasks:
  initialize:
    dataset_config_filename: "dataset_config.json"
    use_directory_index: True
    skip_dirs: []
    select_dirs: ['15814W/COPD1/15814W_INSP_B31f_322_COPD1', # 91 Selected subjects from the never smoked cohort
                  '16303C/COPD1/16303C_INSP_B31f_306_COPD1',
                  '16315J/COPD1/16315J_INSP_B31f_314_COPD1',
                  '16409S/COPD1/16409S_INSP_B31f_344_COPD1',
                  '16496N/COPD1/16496N_INSP_B31f_349_COPD1',
                  '16499T/COPD1/16499T_INSP_B31f_293_COPD1',
                  '16617Z/COPD1/16617Z_INSP_B31f_345_COPD1',
                  '17094Y/COPD1/17094Y_INSP_B31f_277_COPD1',
                  '17135M/COPD1/17135M_INSP_B31f_285_COPD1',
                  '17242N/COPD1/17242N_INSP_B31f_343_COPD1',
                  '17257A/COPD1/17257A_INSP_B31f_296_COPD1',
                  '17258C/COPD1/17258C_INSP_B31f_323_COPD1',
                  '17275C/COPD1/17275C_INSP_B31f_319_COPD1',
                  '17871S/COPD1/17871S_INSP_B31f_270_COPD1',
                  '17880T/COPD1/17880T_INSP_B31f_349_COPD1',
                  '17888J/COPD1/17888J_INSP_B31f_294_COPD1',
                  '17929X/COPD1/17929X_INSP_B31f_330_COPD1',
                  '17946X/COPD1/17946X_INSP_B31f_358_COPD1',
                  '18216R/COPD1/18216R_INSP_B31f_308_COPD1',
                  '18347G/COPD1/18347G_INSP_B31f_311_COPD1',
                  '18398X/COPD1/18398X_INSP_B31f_381_COPD1',
                  '18501Q/COPD1/18501Q_INSP_B31f_291_COPD1',
                  '18535H/COPD1/18535H_INSP_B31f_291_COPD1',
                  '18586Y/COPD1/18586Y_INSP_B31f_315_COPD1',
                  '18615F/COPD1/18615F_INSP_STD_380_COPD1',
                  '18663Q/COPD1/18663Q_INSP_STD_360_COPD1',
                  '18666W/COPD1/18666W_INSP_B31f_305_COPD1',
                  '18680Q/COPD1/18680Q_INSP_B_366_COPD1',
                  '18737T/COPD1/18737T_INSP_B31f_327_COPD1',
                  '18744Q/COPD1/18744Q_INSP_B31f_391_COPD1',
                  '18747W/COPD1/18747W_INSP_B31f_310_COPD1',
                  '18749A/COPD1/18749A_INSP_B31f_332_COPD1',
                  '18757Z/COPD1/18757Z_INSP_B31f_301_COPD1',
                  '18762S/COPD1/18762S_INSP_B31f_399_COPD1',
                  '18763U/COPD1/18763U_INSP_B31f_348_COPD1',
                  '18765Y/COPD1/18765Y_INSP_B31f_384_COPD1',
                  '18775B/COPD1/18775B_INSP_STD_330_COPD1',
                  '18782Y/COPD1/18782Y_INSP_B31f_335_COPD1',
                  '18800A/COPD1/18800A_INSP_B31f_328_COPD1',
                  '18802E/COPD1/18802E_INSP_B31f_285_COPD1',
                  '18810D/COPD1/18810D_INSP_B31f_295_COPD1',
                  '18822K/COPD1/18822K_INSP_B31f_320_COPD1',
                  '18825Q/COPD1/18825Q_INSP_B31f_345_COPD1',
                  '18826S/COPD1/18826S_INSP_B31f_371_COPD1',
                  '18829Y/COPD1/18829Y_INSP_B31f_339_COPD1',
                  '18849E/COPD1/18849E_INSP_B31f_285_COPD1',
                  '18856B/COPD1/18856B_INSP_STD_330_COPD1',
                  '18874D/COPD1/18874D_INSP_B31f_324_COPD1',
                  '18877J/COPD1/18877J_INSP_B31f_356_COPD1',
                  '18881A/COPD1/18881A_INSP_B31f_281_COPD1',
                  '18890B/COPD1/18890B_INSP_B31f_299_COPD1',
                  '18918X/COPD1/18918X_INSP_B31f_365_COPD1',
                  '18954B/COPD1/18954B_INSP_STD_360_COPD1',
                  '18959L/COPD1/18959L_INSP_B31f_369_COPD1',
                  '18964E/COPD1/18964E_INSP_B31f_265_COPD1',
                  '18965G/COPD1/18965G_INSP_B31f_310_COPD1',
                  '18972D/COPD1/18972D_INSP_B31f_310_COPD1',
                  '18977N/COPD1/18977N_INSP_B31f_325_COPD1',
                  '19003F/COPD1/19003F_INSP_B31f_340_COPD1',
                  '19020F/COPD1/19020F_INSP_B31f_300_COPD1',
                  '19035S/COPD1/19035S_INSP_B31f_305_COPD1',
                  '19043R/COPD1/19043R_INSP_B31f_300_COPD1',
                  '19066D/COPD1/19066D_INSP_B31f_368_COPD1',
                  '19084F/COPD1/19084F_INSP_B31f_301_COPD1',
                  '19157G/COPD1/19157G_INSP_B31f_336_COPD1',
                  '19161X/COPD1/19161X_INSP_B31f_317_COPD1',
                  '19174G/COPD1/19174G_INSP_B31f_272_COPD1',
                  '19183H/COPD1/19183H_INSP_B31f_329_COPD1',
                  '19229F/COPD1/19229F_INSP_STD_330_COPD1',
                  '19266L/COPD1/19266L_INSP_B31f_350_COPD1',
                  '19288V/COPD1/19288V_INSP_B31f_320_COPD1',
                  '19373M/COPD1/19373M_INSP_B31f_330_COPD1',
                  '19444J/COPD1/19444J_INSP_STD_300_COPD1',
                  '19512A/COPD1/19512A_INSP_STD_360_COPD1',
                  '19564T/COPD1/19564T_INSP_B31f_326_COPD1',
                  '19626P/COPD1/19626P_INSP_STD_360_COPD1',
                  '19647X/COPD1/19647X_INSP_STD_330_COPD1',
                  '19685F/COPD1/19685F_INSP_B31f_353_COPD1',
                  '19985R/COPD1/19985R_INSP_B_343_COPD1',
                  '20055L/COPD1/20055L_INSP_STD_360_COPD1',
                  '20168Y/COPD1/20168Y_INSP_B31f_350_COPD1',
                  '20222E/COPD1/20222E_INSP_B31f_360_COPD1',
                  '20303E/COPD1/20303E_INSP_STD_340_COPD1',
                  '20387K/COPD1/20387K_INSP_STD_360_COPD1',
                  '20388M/COPD1/20388M_INSP_STD_329_COPD1',
                  '20559N/COPD1/20559N_INSP_STD_360_COPD1',
                  '21084X/COPD1/21084X_INSP_STD_340_COPD1',
                  '21139W/COPD1/21139W_INSP_STD_360_COPD1',
                  '21234Q/COPD1/21234Q_INSP_STD_360_COPD1',
                  '21879K/COPD1/21879K_INSP_STD_350_COPD1',
                  '22778J/COPD1/22778J_INSP_STD_360_COPD1',
                  ]

  extract_torso:
    task: "ExtractTorso"
    source_directory: "dicom"
    results_directory: "extract_torso"
    output_filename: "torso"
    params: { threshold: -320 }

  create_meshes_sw:
    task: "CreateMeshesSW"
    source_directory: "extract_torso"
    results_directory: "create_meshes_torso_for_inspection"
    image_glob: "*.nii"
    params: {
      pad: False,
      step_size: 3,
      decimate: False,
      remesh: False,
      smooth: False,
      fill_holes: False,
      remove_shared_faces: False,
      isolate_mesh: False }

  inspect_meshes:
    task: InspectMeshes
    source_directory: "create_meshes_torso_for_inspection"
    results_directory: "mesh_inspection_never_smoked_INSP"
    params: {}

  logging:


run_tasks: ["extract_torso", "create_meshes_sw", "inspect_meshes" ]