# Workflow to refine subject selection by inspecting torso meshes for holes
# Selected dirs can be regenerated by copying from formatted output of select_copdgene_subjects.yaml
dataset_root: null
log_level: "INFO"
use_multiprocessing: False

tasks:
  initialize:
    dataset_config_filename: "dataset_config.json"
    use_directory_index: True
    skip_dirs: []
    select_dirs: ['16032X/COPD2/16032X_INSP_B31f_363_COPD2', # Selected subjects from COPDGene phase 2 never smoked cohort
                  '16311B/COPD2/16311B_INSP_B31f_277_COPD2',
                  '16496N/COPD2/16496N_INSP_B31f_349_COPD2',
                  '16499T/COPD2/16499T_INSP_B31f_293_COPD2',
                  '16617Z/COPD2/16617Z_INSP_B31f_345_COPD2',
                  '17094Y/COPD2/17094Y_INSP_B31f_277_COPD2',
                  '17135M/COPD2/17135M_INSP_B31f_285_COPD2',
                  '17880T/COPD2/17880T_INSP_B31f_349_COPD2',
                  '17888J/COPD2/17888J_INSP_B31f_294_COPD2',
                  '17929X/COPD2/17929X_INSP_B31f_330_COPD2',
                  '17946X/COPD2/17946X_INSP_B31f_358_COPD2',
                  '18398X/COPD2/18398X_INSP_B31f_381_COPD2',
                  '18586Y/COPD2/18586Y_INSP_Bf40d_315_COPD2',
                  '18612Z/COPD2/18612Z_INSP_STD_290_COPD2',
                  '18615F/COPD2/18615F_INSP_STD_380_COPD2',
                  '18663Q/COPD2/18663Q_INSP_B31f_360_COPD2',
                  '18666W/COPD2/18666W_INSP_Bf40d_305_COPD2',
                  '18737T/COPD2/18737T_INSP_B31f_327_COPD2',
                  '18747W/COPD2/18747W_INSP_Bf40d_310_COPD2',
                  '18765Y/COPD2/18765Y_INSP_B31f_384_COPD2',
                  '18775B/COPD2/18775B_INSP_B31f_330_COPD2',
                  '18782Y/COPD2/18782Y_INSP_Bf40d_335_COPD2',
                  '18802E/COPD2/18802E_INSP_Bf40d_285_COPD2',
                  '18822K/COPD2/18822K_INSP_B31f_320_COPD2',
                  '18825Q/COPD2/18825Q_INSP_Bf40d_345_COPD2',
                  '18826S/COPD2/18826S_INSP_Bf40d_371_COPD2',
                  '18877J/COPD2/18877J_INSP_B31f_356_COPD2',
                  '18890B/COPD2/18890B_INSP_B31f_299_COPD2',
                  '18918X/COPD2/18918X_INSP_B31f_365_COPD2',
                  '18954B/COPD2/18954B_INSP_B31f_360_COPD2',
                  '18959L/COPD2/18959L_INSP_Bf40d_369_COPD2',
                  '18964E/COPD2/18964E_INSP_Bf40d_265_COPD2',
                  '18965G/COPD2/18965G_INSP_B31f_310_COPD2',
                  '18972D/COPD2/18972D_INSP_Bf40d_310_COPD2',
                  '18978P/COPD2/18978P_INSP_Bf40d_305_COPD2',
                  '19003F/COPD2/19003F_INSP_B31f_340_COPD2',
                  '19020F/COPD2/19020F_INSP_Bf40d_300_COPD2',
                  '19043R/COPD2/19043R_INSP_Bf40d_300_COPD2',
                  '19066D/COPD2/19066D_INSP_B31f_368_COPD2',
                  '19084F/COPD2/19084F_INSP_B31f_301_COPD2',
                  '19157G/COPD2/19157G_INSP_B31f_336_COPD2',
                  '19174G/COPD2/19174G_INSP_B31f_272_COPD2',
                  '19183H/COPD2/19183H_INSP_B31f_329_COPD2',
                  '19266L/COPD2/19266L_INSP_B31f_350_COPD2',
                  '19288V/COPD2/19288V_INSP_B31f_320_COPD2',
                  '19444J/COPD2/19444J_INSP_STD_300_COPD2',
                  '19512A/COPD2/19512A_INSP_STD_360_COPD2',
                  '19564T/COPD2/19564T_INSP_B31f_326_COPD2',
                  '19944D/COPD2/19944D_INSP_STD_382_COPD2',
                  '19985R/COPD2/19985R_INSP_B_343_COPD2',
                  '20222E/COPD2/20222E_INSP_B31f_360_COPD2',
                  '20303E/COPD2/20303E_INSP_STD_340_COPD2',
                  '20387K/COPD2/20387K_INSP_STD_360_COPD2',
                  '20388M/COPD2/20388M_INSP_STD_360_COPD2',
                  '20559N/COPD2/20559N_INSP_STD_370_COPD2',
                  '21139W/COPD2/21139W_INSP_STD_360_COPD2',
                  '21234Q/COPD2/21234Q_INSP_STD_360_COPD2',
                  '22778J/COPD2/22778J_INSP_STD_360_COPD2',
                  '30003Y/COPD2/30003Y_INSP_STD_320_COPD2',
                  '30004A/COPD2/30004A_INSP_STD_310_COPD2',
                  '30007G/COPD2/30007G_INSP_STD_290_COPD2',
                  '30012Z/COPD2/30012Z_INSP_STD_310_ASIR40_COPD2',
                  '30030B/COPD2/30030B_INSP_B31f_310_COPD2',
                  '30032F/COPD2/30032F_INSP_B31f_309_COPD2',
                  '30033H/COPD2/30033H_INSP_B31f_316_COPD2',
                  '30034J/COPD2/30034J_INSP_B31f_287_COPD2',
                  '30036N/COPD2/30036N_INSP_B31f_292_COPD2',
                  '30038R/COPD2/30038R_INSP_B31f_320_COPD2',
                  '30039T/COPD2/30039T_INSP_B31f_305_COPD2',
                  '30040E/COPD2/30040E_INSP_B31f_350_COPD2',
                  '30044M/COPD2/30044M_INSP_B31f_337_COPD2',
                  '30048U/COPD2/30048U_INSP_B31f_299_COPD2',
                  '30049W/COPD2/30049W_INSP_B31f_274_COPD2',
                  '30050H/COPD2/30050H_INSP_B31f_260_COPD2',
                  '30053N/COPD2/30053N_INSP_B31f_282_COPD2',
                  '30055R/COPD2/30055R_INSP_B31f_300_COPD2',
                  '30056T/COPD2/30056T_INSP_B31f_310_COPD2',
                  '30063Q/COPD2/30063Q_INSP_B31f_300_COPD2',
                  '30064S/COPD2/30064S_INSP_B31f_320_COPD2',
                  '30065U/COPD2/30065U_INSP_B31f_320_COPD2',
                  '30066W/COPD2/30066W_INSP_B31f_350_COPD2',
                  '30067Y/COPD2/30067Y_INSP_B31f_300_COPD2',
                  '30068A/COPD2/30068A_INSP_B31f_280_COPD2',
                  '30069C/COPD2/30069C_INSP_B31f_390_COPD2',
                  '30071P/COPD2/30071P_INSP_B31f_320_COPD2',
                  '30072R/COPD2/30072R_INSP_B31f_340_COPD2',
                  '30073T/COPD2/30073T_INSP_B31f_285_COPD2',
                  '30075X/COPD2/30075X_INSP_B31f_350_COPD2',
                  '30076Z/COPD2/30076Z_INSP_B31f_300_COPD2',
                  '30078D/COPD2/30078D_INSP_B31f_290_COPD2',
                  '30080Q/COPD2/30080Q_INSP_B_394_COPD2',
                  '30081S/COPD2/30081S_INSP_B_350_COPD2',
                  '30082U/COPD2/30082U_INSP_B_350_COPD2',
                  '30083W/COPD2/30083W_INSP_B_350_COPD2',
                  '30086C/COPD2/30086C_INSP_B_347_COPD2',
                  '30088G/COPD2/30088G_INSP_B_297_COPD2',
                  '30095D/COPD2/30095D_INSP_B_340_COPD2',
                  '30096F/COPD2/30096F_INSP_B_350_COPD2',
                  '30098J/COPD2/30098J_INSP_B_360_COPD2',
                  '30107K/COPD2/30107K_INSP_STD_320_COPD2',
                  '30108M/COPD2/30108M_INSP_STD_350_COPD2',
                  '30112D/COPD2/30112D_INSP_STD_380_COPD2',
                  '30113F/COPD2/30113F_INSP_STD_400_COPD2',
                  '30122G/COPD2/30122G_INSP_STD_390_COPD2',
                  '30124K/COPD2/30124K_INSP_STD_340_COPD2',
                  '30130F/COPD2/30130F_INSP_STD_330_COPD2',
                  '30132J/COPD2/30132J_INSP_B31f_332_COPD2',
                  '30136R/COPD2/30136R_INSP_B31f_345_COPD2',
                  '30138V/COPD2/30138V_INSP_B31f_352_COPD2',
                  '30139X/COPD2/30139X_INSP_B31f_338_COPD2',
                  '30147W/COPD2/30147W_INSP_B31f_355_COPD2',
                  '30150L/COPD2/30150L_INSP_B31f_287_COPD2',
                  '30154T/COPD2/30154T_INSP_B31f_337_COPD2',
                  '30155V/COPD2/30155V_INSP_B31f_312_COPD2',
                  '30161Q/COPD2/30161Q_INSP_STD_270_COPD2',
                  '30164W/COPD2/30164W_INSP_STD_280_COPD2',
                  '30165Y/COPD2/30165Y_INSP_STD_280_COPD2',
                  '30167C/COPD2/30167C_INSP_STD_310_COPD2',
                  '30170R/COPD2/30170R_INSP_STD_300_COPD2',
                  '30171T/COPD2/30171T_INSP_STD_340_COPD2',
                  '30172V/COPD2/30172V_INSP_STD_340_COPD2',
                  '30174Z/COPD2/30174Z_INSP_STD_280_COPD2',
                  '30176D/COPD2/30176D_INSP_STD_280_COPD2',
                  '30180U/COPD2/30180U_INSP_STD_285_COPD2',
                  '30181W/COPD2/30181W_INSP_STD_360_COPD2',
                  '30183A/COPD2/30183A_INSP_B31f_300_COPD2',
                  '30210D/COPD2/30210D_INSP_STD_308_COPD2',
                  '30211F/COPD2/30211F_INSP_STD_360_COPD2',
                  '30212H/COPD2/30212H_INSP_STD_382_COPD2',
                  '30214L/COPD2/30214L_INSP_STD_288_COPD2',
                  '30236V/COPD2/30236V_INSP_B31f_290_COPD2',
                  '30237X/COPD2/30237X_INSP_B31f_320_COPD2',
                  '30243S/COPD2/30243S_INSP_B31f_314_COPD2',
                  '30244U/COPD2/30244U_INSP_B31f_310_COPD2',
                  '30245W/COPD2/30245W_INSP_B31f_310_COPD2',
                  '30248C/COPD2/30248C_INSP_B31f_320_COPD2',
                  '30249E/COPD2/30249E_INSP_B31f_320_COPD2',
                  '30250P/COPD2/30250P_INSP_B31f_301_COPD2',
                  '30251R/COPD2/30251R_INSP_B31f_320_COPD2',
                  '30252T/COPD2/30252T_INSP_B31f_267_COPD2',
                  '30253V/COPD2/30253V_INSP_B31f_360_COPD2',
                  '30254X/COPD2/30254X_INSP_B31f_300_COPD2',
                  '30255Z/COPD2/30255Z_INSP_B31f_308_COPD2',
                  '30256B/COPD2/30256B_INSP_B31f_320_COPD2',
                  '30258F/COPD2/30258F_INSP_B31f_290_COPD2',
                  '30260S/COPD2/30260S_INSP_B31f_280_COPD2',
                  '30261U/COPD2/30261U_INSP_STD_320_COPD2',
                  '30263Y/COPD2/30263Y_INSP_STD_380_COPD2',
                  '30313N/COPD2/30313N_INSP_STD_358_COPD2',
                  '30314P/COPD2/30314P_INSP_STD_330_COPD2',
                  '30315R/COPD2/30315R_INSP_STD_320_COPD2',
                  '30317V/COPD2/30317V_INSP_STD_390_COPD2',
                  '30319Z/COPD2/30319Z_INSP_STD_315_COPD2',
                  '30321M/COPD2/30321M_INSP_STD_310_COPD2',
                  '30323Q/COPD2/30323Q_INSP_STD_308_COPD2',
                  '30325U/COPD2/30325U_INSP_STD_280_COPD2',
                  '30327Y/COPD2/30327Y_INSP_STD_390_COPD2',
                  '30328A/COPD2/30328A_INSP_STD_292_COPD2',
                  '30330N/COPD2/30330N_INSP_STD_304_COPD2',
                  '30331P/COPD2/30331P_INSP_STD_330_COPD2',
                  '30335X/COPD2/30335X_INSP_STD_380_COPD2',
                  '30337B/COPD2/30337B_INSP_STD_340_COPD2',
                  '30338D/COPD2/30338D_INSP_STD_324_COPD2',
                  '30341S/COPD2/30341S_INSP_B31f_330_COPD2',
                  '30342U/COPD2/30342U_INSP_B31f_340_COPD2',
                  '30343W/COPD2/30343W_INSP_B31f_280_COPD2',
                  '30345A/COPD2/30345A_INSP_B31f_315_COPD2',
                  '30346C/COPD2/30346C_INSP_B31f_320_COPD2',
                  '30347E/COPD2/30347E_INSP_B31f_295_COPD2',
                  '30348G/COPD2/30348G_INSP_B31f_320_COPD2',
                  '30350T/COPD2/30350T_INSP_B31f_330_COPD2',
                  '30352X/COPD2/30352X_INSP_B31f_270_COPD2',
                  '30353Z/COPD2/30353Z_INSP_B31f_260_COPD2',
                  '30356F/COPD2/30356F_INSP_B31f_320_COPD2',
                  '30357H/COPD2/30357H_INSP_B31f_350_COPD2',
                  '30358J/COPD2/30358J_INSP_B31f_360_COPD2',
                  '30360W/COPD2/30360W_INSP_B31f_320_COPD2',
                  '30361Y/COPD2/30361Y_INSP_B31f_335_COPD2',
                  '30363C/COPD2/30363C_INSP_B31f_280_COPD2',
                  '30367K/COPD2/30367K_INSP_B31f_344_COPD2',
                  '30418B/COPD2/30418B_INSP_B31f_280_COPD2',
                  '30419D/COPD2/30419D_INSP_B31f_300_COPD2',
                  '30421Q/COPD2/30421Q_INSP_B31f_320_COPD2',
                  '30422S/COPD2/30422S_INSP_B31f_320_COPD2',
                  '30426A/COPD2/30426A_INSP_B31f_270_COPD2',
                  '30427C/COPD2/30427C_INSP_B31f_310_COPD2',
                  '30428E/COPD2/30428E_INSP_B31f_350_COPD2',
                  '30429G/COPD2/30429G_INSP_B31f_340_COPD2',
                  '30433X/COPD2/30433X_INSP_B31f_339_COPD2',
                  '30439J/COPD2/30439J_INSP_B31f_350_COPD2',
                  '30440U/COPD2/30440U_INSP_B31f_338_COPD2',
                  '30441W/COPD2/30441W_INSP_B31f_400_COPD2',
                  '30471F/COPD2/30471F_INSP_B31f_368_COPD2',
                  '30472H/COPD2/30472H_INSP_B31f_310_COPD2',
                  '30474L/COPD2/30474L_INSP_B31f_323_COPD2',
                  '30476P/COPD2/30476P_INSP_B31f_271_COPD2',
                  '30479V/COPD2/30479V_INSP_B31f_280_COPD2',
                  '30480G/COPD2/30480G_INSP_B31f_290_COPD2',
                  '30482K/COPD2/30482K_INSP_B31f_295_COPD2',
                  '30483M/COPD2/30483M_INSP_B31f_264_COPD2',
                  '30486S/COPD2/30486S_INSP_B31f_302_COPD2',
                  '30488W/COPD2/30488W_INSP_B31f_300_COPD2',
                  '30490J/COPD2/30490J_INSP_B31f_321_COPD2',
                  '30492N/COPD2/30492N_INSP_B31f_362_COPD2',
                  '30493P/COPD2/30493P_INSP_B31f_333_COPD2',
                  '30494R/COPD2/30494R_INSP_B31f_350_COPD2',
                  '30527G/COPD2/30527G_INSP_B31f_334_COPD2',
                  '30529K/COPD2/30529K_INSP_B31f_292_COPD2',
                  '30532Z/COPD2/30532Z_INSP_B31f_370_COPD2',
                  '30537J/COPD2/30537J_INSP_B31f_350_COPD2',
                  '30610T/COPD2/30610T_INSP_Bf40d_320_COPD2',
                  '30611V/COPD2/30611V_INSP_Bf40d_310_COPD2',
                  '30612X/COPD2/30612X_INSP_Bf40d_300_COPD2',
                  '30614B/COPD2/30614B_INSP_Bf40d_340_COPD2',
                  '30616F/COPD2/30616F_INSP_Bf40d_290_COPD2',
                  '30624E/COPD2/30624E_INSP_B31f_275_COPD2',
                  '30625G/COPD2/30625G_INSP_B31f_290_COPD2',
                  '30627K/COPD2/30627K_INSP_B31f_300_COPD2',
                  '30628M/COPD2/30628M_INSP_B31f_280_COPD2',
                  '30631B/COPD2/30631B_INSP_B31f_340_COPD2',
                  '30632D/COPD2/30632D_INSP_B31f_340_COPD2',
                  '30634H/COPD2/30634H_INSP_B31f_340_COPD2',
                  '30635J/COPD2/30635J_INSP_B31f_358_COPD2',
                  '30637N/COPD2/30637N_INSP_B31f_290_COPD2',
                  '30638P/COPD2/30638P_INSP_B31f_364_COPD2',
                  '30642G/COPD2/30642G_INSP_B31f_320_COPD2',
                  '30644K/COPD2/30644K_INSP_B31f_340_COPD2',
                  '30651H/COPD2/30651H_INSP_B31f_300_COPD2',
                  '30681Q/COPD2/30681Q_INSP_STD_320_COPD2',
                  '30686A/COPD2/30686A_INSP_STD_310_COPD2',
                  '30690R/COPD2/30690R_INSP_STD_320_COPD2',
                  '30701W/COPD2/30701W_INSP_STD_300_COPD2',
                  '30732H/COPD2/30732H_INSP_B31f_289_COPD2',
                  '30733J/COPD2/30733J_INSP_B31f_343_COPD2',
                  '30734L/COPD2/30734L_INSP_B31f_298_COPD2',
                  '30735N/COPD2/30735N_INSP_B31f_282_COPD2',
                  '30736P/COPD2/30736P_INSP_B31f_318_COPD2',
                  '30743M/COPD2/30743M_INSP_B31f_297_COPD2',
                  '30746S/COPD2/30746S_INSP_B31f_340_COPD2',
                  '30749Y/COPD2/30749Y_INSP_B31f_335_COPD2',
                  '30750J/COPD2/30750J_INSP_B31f_295_COPD2',
                  '30753P/COPD2/30753P_INSP_B31f_344_COPD2',
                  '30757X/COPD2/30757X_INSP_B31f_360_COPD2',
                  '30758Z/COPD2/30758Z_INSP_B31f_290_COPD2',
                  '30759B/COPD2/30759B_INSP_B31f_300_COPD2',
                  '30760M/COPD2/30760M_INSP_B31f_330_COPD2',
                  '30762Q/COPD2/30762Q_INSP_B31f_280_COPD2',
                  '30763S/COPD2/30763S_INSP_B31f_280_COPD2',
                  '30884E/COPD2/30884E_INSP_STD_300_COPD2',
                  '30902G/COPD2/30902G_INSP_STD_290_COPD2',
                  '30911H/COPD2/30911H_INSP_STD_290_COPD2',
                  '30912J/COPD2/30912J_INSP_STD_350_COPD2',
                  '30916R/COPD2/30916R_INSP_STD_310_COPD2',
                  '30919X/COPD2/30919X_INSP_STD_360_COPD2',
                  '30927W/COPD2/30927W_INSP_STD_320_COPD2',
                  '30934T/COPD2/30934T_INSP_STD_365_COPD2',
                  '30936X/COPD2/30936X_INSP_STD_350_COPD2',
                  '30939D/COPD2/30939D_INSP_STD_335_COPD2',
                  '30945Y/COPD2/30945Y_INSP_STD_295_COPD2',
                  '30948E/COPD2/30948E_INSP_STD_260_COPD2',
                  '30949G/COPD2/30949G_INSP_STD_340_COPD2',
                  '30950R/COPD2/30950R_INSP_STD_310_COPD2',
                  '30951T/COPD2/30951T_INSP_STD_335_COPD2',
                  '30952V/COPD2/30952V_INSP_STD_340_COPD2',

                  ]

  extract_torso:
    task: "ExtractTorso"
    source_directory: "dicom"
    results_directory: "extract_torso"
    output_filename: "torso"
    params: { threshold: -320 }

  create_meshes_sw:
    task: "CreateMeshesSW"
    source_directory: "extract_torso"
    results_directory: "create_meshes_torso_for_inspection"
    image_glob: "*.nii"
    params: {
      pad: False,
      step_size: 3,
      decimate: False,
      remesh: False,
      smooth: False,
      fill_holes: False,
      remove_shared_faces: False,
      isolate_mesh: False }

  inspect_meshes:
    task: InspectMeshes
    source_directory: "create_meshes_torso_for_inspection"
    results_directory: "mesh_inspection_never_smoked_INSP"
    params: {}

  format_subjects:
    task: "FormatSubjects"
    source_directory: "mesh_inspection_never_smoked_INSP"
    results_directory: "mesh_inspection_never_smoked_INSP_formatted"
    input_file_glob: "*.csv"
    column: "dirpath"
    search_values: { "selected": False }
    formats:
      - { prefix: "'", suffix: "'," }
    delimiter: " "
    newline: "\n"
    params: { }

  logging:


run_tasks: ["extract_torso", "create_meshes_sw", "inspect_meshes", "format_subjects" ]